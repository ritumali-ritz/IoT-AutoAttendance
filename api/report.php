<?php header('Content-Type: application/json'); require 'db.php'; $class_id = isset($_GET['class_id'])?intval($_GET['class_id']):0; $type = isset($_GET['type'])?$_GET['type']:'weekly'; $from = isset($_GET['from'])?$_GET['from']:''; $to = isset($_GET['to'])?$_GET['to']:''; $conds = []; if($class_id) $conds[] = "c.id={$class_id}"; if($from) $conds[] = "a.date >= '{$from}'"; if($to) $conds[] = "a.date <= '{$to}'"; $where = $conds? 'WHERE '.implode(' AND ', $conds):''; $sql = "SELECT a.id,a.roll_no,s.name,c.class_name,a.date,a.time,a.status FROM attendance a LEFT JOIN students s ON a.roll_no=s.roll_no LEFT JOIN classes c ON s.class_id=c.id {$where} ORDER BY a.date DESC"; $res=$mysqli->query($sql); $out=[]; while($r=$res->fetch_assoc()) $out[]=$r; echo json_encode(['data'=>$out]); ?>